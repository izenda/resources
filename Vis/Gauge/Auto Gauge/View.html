<style type="text/css">
	@font-face {
		font-family: 'Open Sans Condensed';
		font-style: normal;
		font-weight: 300;
		src: url('rs.aspx?font=Fonts.OpenSans-CondensedLight.woff') format('woff'), url('rs.aspx?font=Fonts.OpenSans-CondensedLight.woff2') format('woff2');
	}

	/* disable global bootstrap CSS rule */
	#VIS_ID_CONTAINER * {
		-webkit-box-sizing: content-box;
		-moz-box-sizing: content-box;
		box-sizing: content-box;
	}

	#VIS_ID_CONTAINER .izenda-vis-clearfix:after {
		content: "";
		clear: both;
		display: table;
	}

	#VIS_ID_CONTAINER .izenda-vis-group {
		display: block;
		margin: 10px 0;
	}

	#VIS_ID_CONTAINER .izenda-vis-gallery {
		overflow: hidden;
	}

	#VIS_ID_CONTAINER .izenda-vis-gallery label {
		font-size: 13px;
		margin-right: 30px;
		font-weight: normal;
	}

	#VIS_ID_CONTAINER .izenda-vis-control {
		display: inline-block;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-selector {
		height: 27px;
		width: 24px;
		padding-top: 7px;
		cursor: pointer;
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-tile-item {
		width: 98px;
		height: 59px;
		margin: 4px;
		text-indent: 0;
		border: 1px solid #aaaaaa;
		opacity: 0.7;
		display: inline-block;
		cursor: pointer;
		box-sizing: content-box;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-tile-item.izenda-vis-item-checked {
		opacity: 1;
		margin: 2px;
		border: 3px solid #9FD5B7;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-tile-item img {
		width: 98px;
		height: 59px;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-slider .ui-slider,
	#VIS_ID_CONTAINER .izenda-vis-control-slider .iz-ui-slider {
		background-color: #ffffff;
		border: 1px solid #aaaaaa;
		border-radius: 5px;
		display: inline-block;
		height: 4px;
		width: 200px;
		margin-left: 12px;
		margin-bottom: 1px;
		position: relative;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-slider .ui-slider-handle,
	#VIS_ID_CONTAINER .izenda-vis-control-slider .iz-ui-slider-handle {
		background-color: #eaeaea !important;
		border: 1px solid #aaaaaa;
		border-radius: 50%;
		height: 12px;
		width: 12px;
		position: absolute;
		top: 0;
		margin: -0.4em;
		cursor: pointer;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-multibutton {
		border: 1px solid #d0d0d0;
		border-radius: 3px;
		display: inline-block;
		margin-right: 20px;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-multibutton-item {
		display: inline-block;
		background-color: #ffffff;
		border-right: 1px solid #d0d0d0;
		padding: 5px 10px;
		font-size: 13px;
		font-weight: bold;
		color: #555555;
		cursor: pointer;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-multibutton-item:last-child {
		border-right: none;
	}

	#VIS_ID_CONTAINER .izenda-vis-control-multibutton-item.izenda-vis-item-checked {
		background-color: #e5e5e5;
		color: #222222;
	}

	#VIS_ID_CONTAINER #VIS_ID_PROPERTIES_PANEL {
		opacity: 0;
		font-size: 12px;
		color: #999999;
		height: 30px;
		width: auto;
	}

	#VIS_ID_CONTAINER #VIS_ID_PROPERTIES_PANEL #VIS_ID_GEAR_GALLERY_SELECTOR {
		background: url('Resources/Vis/Gauge/Auto Gauge/images/gear.png') no-repeat center center;
	}

	#VIS_ID_CONTAINER #VIS_ID_PROPERTIES_PANEL #VIS_ID_GEAR_GALLERY_SELECTOR:hover {
		background: url('Resources/Vis/Gauge/Auto Gauge/images/gear.hover.png') no-repeat center center;
	}

	#VIS_ID_CONTAINER #VIS_ID_PROPERTIES_PANEL #VIS_ID_GEAR_GALLERY_SELECTOR.izenda-vis-item-checked {
		background: url('Resources/Vis/Gauge/Auto Gauge/images/gear.selected.png') no-repeat center center;
	}

	#VIS_ID_CONTAINER #VIS_ID_PROPERTIES_PANEL #VIS_ID_TYPE_GALLERY_SELECTOR {
		background: url('Resources/Vis/Gauge/Auto Gauge/images/style.png') no-repeat center center;
	}

	#VIS_ID_CONTAINER #VIS_ID_PROPERTIES_PANEL #VIS_ID_TYPE_GALLERY_SELECTOR:hover {
		background: url('Resources/Vis/Gauge/Auto Gauge/images/style.hover.png') no-repeat center center;
	}

	#VIS_ID_CONTAINER #VIS_ID_PROPERTIES_PANEL #VIS_ID_TYPE_GALLERY_SELECTOR.izenda-vis-item-checked {
		background: url('Resources/Vis/Gauge/Auto Gauge/images/style.selected.png') no-repeat center center;
	}

	#VIS_ID_CONTAINER #VIS_ID {
		clear: both;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-wrap-table {
		border-collapse: collapse;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-wrap-table td {
		padding: 0;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-gauge {
		display: inline;
		float: left;
		margin: 20px;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-simple-gauge {
		font-family: 'Open Sans Condensed', sans-serif;
		margin: 10px;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-simple-gauge .izenda-vis-gauge-units {
		fill: #A1A1A1;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-linear-gauge {
		font-family: 'Open Sans Condensed', sans-serif;
		font-weight: bold;
		margin: 15px;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-linear-gauge .izenda-vis-gauge-axis path,
	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-linear-gauge .izenda-vis-gauge-axis line {
		fill: none;
		stroke: #000;
		shape-rendering: crispEdges;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-round-gauge .izenda-vis-gauge-background {
		fill: #e1e1e1;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-round-gauge .izenda-vis-gauge-title {
		font-family: Myriad, "Helvetic Neue", Helvetica, Arial;
		text-anchor: middle;
		fill: #A1A1A1;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-round-gauge .izenda-vis-gauge-arc {
		fill: #00c0d8;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-round-gauge .izenda-vis-gauge-label-value {
		fill: #4A4A4A;
		font-family: Myriad, "Helvetic Neue", Helvetica, Arial;
		font-weight: bold;
		cursor: pointer;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-round-gauge .izenda-vis-gauge-label-format-type {
		fill: #A1A1A1;
		font-family: Myriad, "Helvetic Neue", Helvetica, Arial;
		font-weight: bold;
		cursor: pointer;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge {
		fill: #444444;
		font-weight: bold;
		font-family: 'Open Sans Condensed', sans-serif;
		margin: 0 10px 0 0;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-insetBorder {
		fill: #000000;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-outsetBorder {
		fill: none;
		stroke: #bbbbbb;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-insetBorder {
		fill: none;
		stroke: #ffffff;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-area {
		stroke: #629af0;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-area-point {
		fill: #629af0;
		stroke: #6685b5;
		stroke-width: 1px;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-area-bullseye {
		fill: none;
		stroke: #c00000;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-area-bullseye-inner {
		fill: #c00000;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-current-block .izenda-vis-gauge-current-value {
		fill: #4882ff;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-up-direction .izenda-vis-gauge-relative-value,
	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-up-direction .izenda-vis-gauge-relative-arrow {
		fill: #00ac00;
	}

	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-dn-direction .izenda-vis-gauge-relative-value,
	#VIS_ID_CONTAINER #VIS_ID .izenda-vis-trending-gauge .izenda-vis-gauge-dn-direction .izenda-vis-gauge-relative-arrow {
		fill: #ac0000;
	}

	#VIS_ID_CONTAINER .izenda-vis-gauge-tooltip {
		position: absolute;
		text-align: center;
		padding: 4px;
		font-family: Myriad, "Helvetic Neue", Helvetica, Arial;
		font-size: 12px;
		background: #FFFFFF;
		border: 1px solid rgb(173, 173, 173);
		border-radius: 4px;
		pointer-events: none;
	}
</style>


<div id="VIS_ID_CONTAINER">
	<div id="VIS_ID_HOLDER">
		<div id="VIS_ID_PROPERTIES_PANEL" style="float:right; position: relative; right: 0;">
			<div id="VIS_ID_TYPE_GALLERY_SELECTOR" class="izenda-vis-control izenda-vis-control-selector">&nbsp;</div>
			<div id="VIS_ID_GEAR_GALLERY_SELECTOR" class="izenda-vis-control izenda-vis-control-selector">&nbsp;</div>
		</div>
		<div class="izenda-vis-clearfix"></div>
		<div id="VIS_ID_TYPE_GALLERY" class="izenda-vis-gallery" style="display: none;">
			<div id="VIS_ID_TYPE_CONTROL" class="izenda-vis-control izenda-vis-control-tile">
			</div>
		</div>
		<div id="VIS_ID_GEAR_GALLERY" class="izenda-vis-gallery" style="display: none;">
		</div>
		<div id="VIS_ID" style="overflow: hidden"></div>
	</div>
</div>

<script type="text/javascript" src="d3.v3.min.js"></script>

<script type="text/javascript" src="gauge.base.js"></script>
<script type="text/javascript" src="gauge.simple.js"></script>
<script type="text/javascript" src="gauge.linear.js"></script>
<script type="text/javascript" src="gauge.round.js"></script>
<script type="text/javascript" src="gauge.trending.js"></script>

<script type="text/javascript">
	(function ExecuteVIS_ID() {
		var width = 720, height = 500;

		var util = window.ReportScripting, vis,
			isThumbnails = (document.URL === 'about:blank');

		if (!util.validate("VIS_ID", VIS_FORMJSASTATUS, VIS_CONTEXT, VIS_ROWS, { d3: true, svg: true }))
			return;

		var isImageRender = VIS_CONTEXT.toImage || VIS_CONTEXT.toStatic || isThumbnails;

		var vs = util.container("VIS_ID");

		var sliderEventActive = false;

		var styles = {
			simple: function () {
				return {
					name: "simple",
					initGearGallery: function () {
						var gearGallery = jq$("#VIS_ID_GEAR_GALLERY");
						gearGallery.empty();

						var timeoutId = 0;

						gearGallery.append(jq$("<div></div>").addClass("izenda-vis-control").addClass("izenda-vis-control-slider")
							.append(jq$("<label>Size</label>").append(jq$("<div></div>").attr("id", "VIS_ID_PROPERTY_SIZE_SLIDER"))));

						jq$("#VIS_ID_PROPERTY_SIZE_SLIDER").slider({
							min: 100,
							max: 450,
							value: s.props.gauge.simple.size,
						}).on("slide", function (event, ui) {
							clearTimeout(timeoutId);
							timeoutId = setTimeout(function () {
								gauges.forEach(function (gauge) {
									gauge.resize(ui.value);
								});
								wrapGaugesInTable();
							}, 0);
						}).on("slidechange", function () {
							store();
						}).on("slidestart", function () {
							sliderEventActive = true;
						}).on("slidestop", function () {
							sliderEventActive = false;
						});
					},
					storeProperties: function () {
						return {
							simple: {
								size: jq$('#VIS_ID_PROPERTY_SIZE_SLIDER').slider("option", "value")
							}
						};
					},
					draw: function (name, data) {
						var gaugeDiv = jq$("<div></div>").addClass("izenda-vis-gauge").addClass("izenda-vis-simple-gauge").css("float", "left");
						jq$("#VIS_ID").append(gaugeDiv);
						var gauge = new izenda.gauges.SimpleGauge(gaugeDiv.get(0), name, s.props.gauge.simple.size, data);
						gauges.push(gauge);
						gauge.render(!isImageRender);
					},
					postDrawAll: function () {
						wrapGaugesInTable();
					},
					destroy: function () {
						jq$("#VIS_ID").empty();
						gauges = [];
					}
				};
			},
			linear: function () {
				return {
					name: "linear",
					initGearGallery: function () {
						var gearGallery = jq$("#VIS_ID_GEAR_GALLERY");
						gearGallery.empty();

						gearGallery.append(jq$("<div></div>").addClass("izenda-vis-control").addClass("izenda-vis-control-multibutton").addClass("izenda-vis-modes")
							.append(jq$("<div></div>").addClass("izenda-vis-control-multibutton-item").addClass("izenda-vis-mode").attr("value", "horizontal").text("Horizontal"))
							.append(jq$("<div></div>").addClass("izenda-vis-control-multibutton-item").addClass("izenda-vis-mode").attr("value", "vertical").text("Vertical")));

						gearGallery.find(".izenda-vis-mode")
							.unbind("click")
							.bind("click", function () {
								gearGallery.find(".izenda-vis-mode").removeClass("izenda-vis-item-checked");
								jq$(this).addClass("izenda-vis-item-checked");
								var mode = jq$(this).attr("value");
								setTimeout(function () {
									gauges.forEach(function (gauge) { gauge.changeMode(mode); });
									wrapGaugesInTable();
								}, 0);
								store();
							});

						gearGallery.find(".izenda-vis-mode").removeClass("izenda-vis-item-checked");
						gearGallery.find(".izenda-vis-mode[value=" + s.props.gauge.linear.mode + "]").addClass("izenda-vis-item-checked");

						gearGallery.append(jq$("<div></div>").addClass("izenda-vis-group").append(jq$("<div></div>").addClass("izenda-vis-control").addClass("izenda-vis-control-slider")
							.append(jq$("<label>Size</label>").append(jq$("<div></div>").attr("id", "VIS_ID_PROPERTY_SIZE_SLIDER")))));

						var timeoutId = 0;
						jq$("#VIS_ID_PROPERTY_SIZE_SLIDER").slider({
							min: 200,
							max: 400,
							value: s.props.gauge.linear.size,
						}).on("slide", function (event, ui) {
							clearTimeout(timeoutId);
							timeoutId = setTimeout(function () {
								gauges.forEach(function (gauge) {
									gauge.resize(ui.value);
								});
								wrapGaugesInTable();
							}, 0);
						}).on("slidechange", function () {
							store();
						}).on("slidestart", function () {
							sliderEventActive = true;
						}).on("slidestop", function () {
							sliderEventActive = false;
						});
					},
					storeProperties: function () {
						return {
							linear: {
								mode: jq$('#VIS_ID_GEAR_GALLERY div.izenda-vis-mode.izenda-vis-item-checked').attr("value"),
								size: jq$('#VIS_ID_GEAR_GALLERY #VIS_ID_PROPERTY_SIZE_SLIDER').slider("option", "value")
							}
						};
					},
					draw: function (name, data) {
						var gaugeDiv = jq$("<div></div>").addClass("izenda-vis-gauge").addClass("izenda-vis-linear-gauge").css("float", "left");
						jq$("#VIS_ID").append(gaugeDiv);
						var gauge = new izenda.gauges.LinearGauge(gaugeDiv.get(0), name, s.props.gauge.linear.mode, s.props.gauge.linear.size, data);
						gauges.push(gauge);
						gauge.render(!isImageRender);
					},
					postDrawAll: function () {
						wrapGaugesInTable();
					},
					destroy: function () {
						jq$("#VIS_ID").empty();
						gauges = [];
					}
				};
			},
			round: function () {
				var diameter = 200,
					gaugesBlock = {},
					gaugesPerBlock = Math.floor(width / (diameter - 30 + 40)) || 1;

				return {
					name: "round",
					initGearGallery: function () {
						var gearGallery = jq$("#VIS_ID_GEAR_GALLERY");
						gearGallery.empty();

						var timeoutId = 0;

						gearGallery.append(jq$("<div></div>").addClass("izenda-vis-control").addClass("izenda-vis-control-slider")
							.append(jq$("<label>Size</label>").append(jq$("<div></div>").attr("id", "VIS_ID_PROPERTY_SIZE_SLIDER"))));

						jq$("#VIS_ID_PROPERTY_SIZE_SLIDER").slider({
							min: 60,
							max: 360,
							value: s.props.gauge.round.size,
						}).on("slide", function (event, ui) {
							clearTimeout(timeoutId);
							timeoutId = setTimeout(function () {
								gauges.forEach(function (gauge) {
									gauge.setDegree(ui.value);
								});
							}, 0);
						}).on("slidechange", function () {
							store();
						}).on("slidestart", function() {
							sliderEventActive = true;
						}).on("slidestop", function() {
							sliderEventActive = false;
						});

						gearGallery.append(jq$("<div></div>").addClass("izenda-vis-control").addClass("izenda-vis-control-slider")
							.append(jq$("<label>Width</label>").append(jq$("<div></div>").attr("id", "VIS_ID_PROPERTY_WIDTH_SLIDER"))));

						jq$("#VIS_ID_PROPERTY_WIDTH_SLIDER").slider({
							min: 1,
							max: 50,
							value: s.props.gauge.round.width,
						}).on("slide", function (event, ui) {
							clearTimeout(timeoutId);
							timeoutId = setTimeout(function () {
								gauges.forEach(function (gauge) {
									gauge.setTickness(ui.value);
								});
							}, 0);
						}).on("slidechange", function () {
							store();
						}).on("slidestart", function () {
							sliderEventActive = true;
						}).on("slidestop", function () {
							sliderEventActive = false;
						});
					},
					storeProperties: function () {
						return {
							round: {
								size: jq$('#VIS_ID_PROPERTY_SIZE_SLIDER').slider("option", "value"),
								width: jq$('#VIS_ID_PROPERTY_WIDTH_SLIDER').slider("option", "value")
							}
						};
					},
					draw: function (name, data) {
						if (gauges.length % gaugesPerBlock == 0) {
							gaugesBlock = jq$("<div></div>").css("float", "left");
							jq$("#VIS_ID").append(gaugesBlock);
						}

						var gaugeDiv = jq$("<div></div>").addClass("izenda-vis-gauge").addClass("izenda-vis-round-gauge");
						gaugesBlock.append(gaugeDiv);

						var gauge = new izenda.gauges.RoundGauge(gaugeDiv.get(0), name, s.props.gauge.round.size, s.props.gauge.round.width, data);
						gauges.push(gauge);
						gauge.render(!isImageRender);
					},
					postDrawAll: function () { },
					destroy: function () {
						jq$("#VIS_ID").empty();
						gauges = [];
					}
				};
			},
			trending: function () {
				return {
					name: "trending",
					initGearGallery: function () {
						var gearGallery = jq$("#VIS_ID_GEAR_GALLERY");
						gearGallery.empty();

						var timeoutId = 0;

						gearGallery.append(jq$("<div></div>").addClass("izenda-vis-control").addClass("izenda-vis-control-slider")
							.append(jq$("<label>Size</label>").append(jq$("<div></div>").attr("id", "VIS_ID_PROPERTY_SIZE_SLIDER"))));

						jq$("#VIS_ID_PROPERTY_SIZE_SLIDER").slider({
							min: 200,
							max: 600,
							value: s.props.gauge.trending.size,
						}).on("slide", function (event, ui) {
							clearTimeout(timeoutId);
							timeoutId = setTimeout(function () {
								gauges.forEach(function (gauge) {
									gauge.resize(ui.value);
								});
							}, 0);
						}).on("slidechange", function () {
							store();
						}).on("slidestart", function () {
							sliderEventActive = true;
						}).on("slidestop", function () {
							sliderEventActive = false;
						});
					},
					storeProperties: function () {
						return {
							trending: {
								size: jq$('#VIS_ID_PROPERTY_SIZE_SLIDER').slider("option", "value")
							}
						};
					},
					draw: function (name, data) {
						var gaugeDiv = jq$("<div></div>").addClass("izenda-vis-gauge").addClass("izenda-vis-trending-gauge").css("float", "left");
						jq$("#VIS_ID").append(gaugeDiv);
						var gauge = new izenda.gauges.TrendingGauge(gaugeDiv.get(0), name, s.props.gauge.trending.size, data);
						gauges.push(gauge);
						gauge.render(!isImageRender);
					},
					postDrawAll: function () {

					},
					destroy: function () {
						jq$("#VIS_ID").empty();
						gauges = [];
					}
				};
			}
		};

		window.visState = window.visState || {};
		var s = window.visState.VIS_ID || (window.visState.VIS_ID = {});
		if (!s.props) {
			try {
				s.props = {
					gauge: {
						style: "",
						simple: {
							size: 150
						},
						linear: {
							mode: "horizontal",
							size: 200
						},
						round: {
							size: 360,
							width: 5
						},
						trending: {
							size: 400
						}
					}
				};

				jq$.extend(true, s.props, JSON.parse(VIS_CONTEXT.props));

			} catch (e) {
				s.props = {};
				util.logger.error(e);
			}
		}

		vis = new util("VIS_ID", VIS_FORMJSASTATUS, VIS_COLUMNS, VIS_ROWS, VIS_CONTEXT);

		width = vis.getWidth();

		vs.find("#VIS_ID").width(width);

		var style, gauges = [];

		//temp solution
		var urlSettings = UrlSettings();
		var typeControl = jq$('#VIS_ID_TYPE_CONTROL');
		['Simple', 'Linear', 'Round', 'Trending'].forEach(function (e) {
			var item = jq$('<div>').addClass('izenda-vis-control-tile-item').attr('value', e.toLowerCase())
				.append(jq$('<a>').attr('href', 'javascript:void(0)').attr('title', e + ' Style')
					.append(jq$('<img>').attr('src', (urlSettings.urlBase ? urlSettings.urlBase + '/' : '') + 'Resources/Vis/Gauge/Auto Gauge/images/styles/' + e.toLowerCase() + '-style.png')));
			typeControl.append(item);
		});

		var isDateExist = false;
		for (var i = 0; i < VIS_COLUMNS.length; ++i) {
			if (VIS_COLUMNS[i].type == "DateTime") {
				isDateExist = true;
				break;
			}
		}

		if (!isDateExist) {
			jq$("#VIS_ID_TYPE_CONTROL [value='trending']").hide();
		}

		if (!s.props.gauge.style || s.props.gauge.style == "trending") {
			s.props.gauge.style = (isDateExist) ? "trending" : "simple";
		}

		style = styles[s.props.gauge.style]();

		function initSelector(id, context) {
			vs.find(id)
				.unbind("click")
				.bind("click", context.onClick);
		}

		function toggleSelectorVisibility(id, visible) {
			var selector = vs.find(id);
			if (visible) {
				selector.show();
			} else {
				selector.hide();
			}
		}

		var galleries = {};

		function initGallery(id, context, initContentHandle) {
			galleries[id] = {
				gallery: vs.find(id)
					.css({ "z-index": 1 }),
				context: context,
				t: undefined
			};

			jq$.extend(galleries[id].context, {
				show: function () {
					hideGalleries(id);
					dropGalleryTimeout(id);
					showGallery(id);
					galleries[id].gallery.bind("mouseenter", function () {
						dropGalleryTimeout(id);
						galleries[id].gallery.bind("mouseleave", function () {
							function hideGalleryByCondition() {
								setTimeout(function () {
									if (sliderEventActive) {
										hideGalleryByCondition();
									} else {
										setGalleryTimeout(id, context.hideTimeout);
									}
								}, 100);
							}
							hideGalleryByCondition();
						});
					});
				},
				hide: function () {
					dropGalleryTimeout(id);
					hideGallery(id);
				}
			});

			initSelector(id + "_SELECTOR", {
				onClick: function () {

					if (galleries[id].gallery.is(":visible")) {
						galleries[id].context.hide();
					} else {
						galleries[id].context.show();
					}
				}
			});

			if (typeof initContentHandle === "function") {
				initContentHandle();
			}
		}

		function showGallery(id) {
			vs.find(id).slideDown({ duration: 300 });
			vs.find(id + "_SELECTOR").addClass("izenda-vis-item-checked");
		}

		function hideGallery(id) {
			vs.find(id).slideUp({ duration: 200 });
			vs.find(id + "_SELECTOR").removeClass("izenda-vis-item-checked");
		}

		function hideGalleries(id) {
			util.enumerateFields(galleries, function (obj, galleryId) {
				if (galleryId != id) {
					dropGalleryTimeout(galleryId);
					hideGallery(galleryId);
				}
			});
		}

		function setGalleryTimeout(id, timeout) {
			dropGalleryTimeout(id);
			if (!timeout) {
				return;
			}
			galleries[id].t = setTimeout(function () {
				galleries[id].gallery
					.unbind("mouseenter")
					.unbind("mouseleave");
				hideGallery(id);
			}, timeout);
		}

		function dropGalleryTimeout(id) {
			if (galleries[id].t) {
				clearTimeout(galleries[id].t);
			}
		}

		function validateControls() {
			var gaugeStyle = jq$("#VIS_ID_TYPE_GALLERY div.izenda-vis-control-tile-item.izenda-vis-item-checked").attr("value");
			if (gaugeStyle) {
				s.props.gauge.style = gaugeStyle;

				jq$.extend(s.props.gauge, style.storeProperties());

				return true;
			}
			return false;
		}

		function store() {
			if (validateControls()) {
				vis.setProps(s.props);
			}
		}

		if (!isImageRender) {
			var propertiesPanel = d3.select("#VIS_ID_PROPERTIES_PANEL");
			d3.select("#VIS_ID_CONTAINER")
				.on("mouseover", function (d) {
					propertiesPanel.transition()
						.duration(500)
						.style("opacity", 1);
				})
				.on("mouseout", function (d) {
					propertiesPanel.transition()
						.duration(500)
						.style("opacity", 0)
						.each("end", hideGalleries);
				});

			initGallery("#VIS_ID_TYPE_GALLERY", { hideTimeout: 1000 }, function () {
				galleries["#VIS_ID_TYPE_GALLERY"].gallery.find("div.izenda-vis-control-tile-item")
				.unbind("click")
				.bind("click", function () {
					galleries["#VIS_ID_TYPE_GALLERY"].gallery.find("div.izenda-vis-control-tile-item").removeClass("izenda-vis-item-checked");
					jq$(this).addClass("izenda-vis-item-checked");

					style.destroy();
					style = styles[jq$(this).attr("value")]();

					style.initGearGallery();

					store();

					waitFontFaceOnLoadAndDraw();
				});
			});

			galleries["#VIS_ID_TYPE_GALLERY"].gallery.find("div.izenda-vis-control-tile-item").removeClass("izenda-vis-item-checked");
			jq$("div.izenda-vis-control-tile-item[value=" + s.props.gauge.style + "]").addClass("izenda-vis-item-checked");

			initGallery("#VIS_ID_GEAR_GALLERY", { hideTimeout: 1000 }, style.initGearGallery);

			toggleSelectorVisibility("#VIS_ID_TYPE_GALLERY_SELECTOR", !VIS_CONTEXT.isDashboard || VIS_CONTEXT.showVisPropertiesInDashboards);
			toggleSelectorVisibility("#VIS_ID_GEAR_GALLERY_SELECTOR", !VIS_CONTEXT.isDashboard || VIS_CONTEXT.showVisPropertiesInDashboards);
		}

		function wrapGaugesInTable() {

			if (jq$("#VIS_ID").get(0).offsetWidth == 0) {
				return;
			}

			var w0 = 0, i0 = 1;
			for (var i = 0; i < gauges.length && (w0 + gauges[i].parent.offsetWidth <= width) ; ++i) {
				w0 += gauges[i].parent.offsetWidth + 20;
				i0 = i + 1;
			}

			for (var j = i0; j >= 0; --j) {
				var rowsCount = Math.ceil(gauges.length / j);
				var gaugesTable = jq$("<table></table>").addClass("izenda-vis-wrap-table");
				for (var k = 0; k < rowsCount; ++k) {
					var tr = jq$("<tr></tr>");
					for (var l = 0; l < ((k + 1 != rowsCount || gauges.length % j == 0) ? j : (gauges.length % j)) ; ++l) {
						tr.append(jq$("<td></td>").append(gauges[k * j + l].parent));
					}
					gaugesTable.append(tr);
				}

				jq$("#VIS_ID").empty().append(gaugesTable);

				if (gaugesTable.get(0).offsetWidth <= width || j == 1) {
					break;
				}
			}
		}

		function getProcessedData(node) {
			var data = {};

			data.items = [];

			for (var key in node) {
				switch (key.toLowerCase()) {
					case "units":
						data.units = { value: node[key] };
						break;
				}
			}

			for (var key in node.support) {
				var origin = node.support[key].o,
					formatted = node.support[key].f;

				if (VIS_COLUMNS.find(function (d) { return d.name == key; }).format == "MoneyDividedByHundred")
					origin /= 100;

				switch (key.toLowerCase()) {
					case "low":
						data.low = { name: "low", value: origin, color: "#00C000" };
						break;
					case "high":
						data.high = { name: "high", value: origin, color: "#C00000" };
						break;
					case "target":
						data.target = { name: "target", value: origin, color: "#0034ff" };
						break;
					case "max":
						data.max = {
							value: origin,
							format: (function () {
								var precisionMatch = formatted.match(/(\.)(\d+)/),
									currencyMath = formatted.match(/\$|€|£/);
								return {
									precision: (precisionMatch) ? precisionMatch[2].length : 0,
									isCurrency: currencyMath != null,
									currency: (currencyMath) ? currencyMath[0] : "",
									isPercentage: /%/.test(formatted)
								};
							})()
						};
						break;
					default:
						if (origin instanceof Date) {
							data.date = origin;
						} else if (typeof origin === "number") {
							data.items.push({
								value: origin,
								format: (function () {
									var precisionMatch = formatted.match(/(\.)(\d+)/),
										currencyMath = formatted.match(/\$|€|£/);
									return {
										precision: (precisionMatch) ? precisionMatch[2].length : 0,
										isCurrency: currencyMath != null,
										currency: (currencyMath) ? currencyMath[0] : "",
										isPercentage: /%/.test(formatted)
									};
								})()
							});
						}
						break;
				}
			}

			return data;
		}

		function drawAllGauges() {
			if (vis.getItems().length == 0) {
				return;
			}

			if (style.name == "trending") {
				var items = {};
				jq$.each(vis.getItems(), function (index, item) {
					var name = vis.cellValue(index, 0, false);
					if (!items[name]) {
						items[name] = [];
					}

					var data = getProcessedData(item);
					if (data.date) {
						items[name].push(data);
					}
				});

				for (var key in items) {
					var values = items[key];

					if (values.length > 1) {
						style.draw(key, values);
					}
				}
			} else {
				jq$.each(vis.getItems(), function (index, item) {
					var name = vis.cellValue(index, 0, false);
					style.draw(name, getProcessedData(item));
				});
			}
			style.postDrawAll();
		}

		function waitFontFaceOnLoadAndDraw() {
			if ((style.name == "simple" || style.name == "linear" || style.name == "trending") && !isImageRender) {
				FontFaceOnload('Open Sans Condensed', {
					success: function () {
						try {
							drawAllGauges();
						} catch (err) {
							var gaugeDiv = jq$("<div></div>")
								.html("Error: " + err);
							jq$("#VIS_ID").empty().append(gaugeDiv);
						}
					},
					error: function () {
						var gaugeDiv = jq$("<div></div>")
							.html("Interactive Visualizations are not available: the webfont has not been loaded.");
						jq$("#VIS_ID").empty().append(gaugeDiv);
					},
					timeout: 5000
				});
			} else {
				drawAllGauges();

			}
		}

		waitFontFaceOnLoadAndDraw();

		util.registerResize("VIS_ID", ExecuteVIS_ID, function () {
			style.destroy();
			jq$("#VIS_ID").empty();
		});
	})();
</script>